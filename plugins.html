<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SFDocs Markdown Plugins</title>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }
    h1 { color: #1a1a1a; border-bottom: 2px solid #0070d2; padding-bottom: 10px; }
    h2 { color: #0070d2; margin-top: 30px; }
    h3 { color: #444; }
    table { border-collapse: collapse; width: 100%; margin: 15px 0; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    th { background-color: #f5f5f5; }
    code { background-color: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
    pre { background-color: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; }
    ul { margin: 10px 0; }
    hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
    a { color: #0070d2; }
  </style>
</head>
<body>

<h1>SFDocs Markdown Plugins</h1>

<h2>Table of Contents</h2>
<ol>
  <li>Why Plugins?</li>
  <li>The Ecosystem</li>
  <li>Directive Types</li>
  <li>Callout Plugin Deep Dive</li>
  <li>Video Plugin Overview</li>
  <li>SFDocs Integration</li>
  <li>Creating a New Plugin</li>
  <li>Debugging</li>
  <li>Publishing Alpha Packages</li>
  <li>References</li>
</ol>

<hr>

<h2>1. Why Plugins?</h2>
<p>Standard Markdown is limited. Plugins extend it to support:</p>
<ul>
  <li><strong>Callouts</strong> (tips, warnings, notes)</li>
  <li><strong>Video embeds</strong> (YouTube, Vidyard, local)</li>
  <li><strong>Include</strong> shared content from other files</li>
  <li><strong>Interactive components</strong> (LWC Playground)</li>
</ul>

<hr>

<h2>2. The Ecosystem</h2>

<table>
  <tr><th>Term</th><th>What it is</th></tr>
  <tr><td><strong>Unified</strong></td><td>Processing pipeline framework (parse → transform → stringify)</td></tr>
  <tr><td><strong>Remark</strong></td><td>Markdown processor built on Unified</td></tr>
  <tr><td><strong>MDAST</strong></td><td>Markdown Abstract Syntax Tree</td></tr>
  <tr><td><strong>HAST</strong></td><td>HTML Abstract Syntax Tree</td></tr>
</table>

<h3>The Pipeline</h3>
<pre>Markdown → MDAST → (plugins transform) → HAST → HTML</pre>

<h3>Run the Demo</h3>
<pre>cd sfdocs-plugins-kt
npm install
npm run demo</pre>

<hr>

<h2>3. Directive Types</h2>
<p>Based on the <a href="https://talk.commonmark.org/t/generic-directives-plugins-syntax/444">CommonMark Generic Directives Proposal</a>.</p>

<table>
  <tr><th>Type</th><th>Colons</th><th>HTML Analogy</th><th>Example</th></tr>
  <tr><td><strong>Inline</strong></td><td><code>:name</code></td><td>&lt;span&gt;</td><td><code>:abbr[HTML]{title="..."}</code></td></tr>
  <tr><td><strong>Leaf</strong></td><td><code>::name</code></td><td>&lt;div/&gt; (empty)</td><td><code>::video{src="..."}</code></td></tr>
  <tr><td><strong>Container</strong></td><td><code>:::name</code></td><td>&lt;div&gt;...&lt;/div&gt;</td><td><code>:::warning ... :::</code></td></tr>
</table>

<h3>Nesting (More colons = outer container)</h3>
<pre>::::::tabset{tabs='["Tab1", "Tab2"]'}
:::::tab
:::tip
Content inside tab
:::
:::::
::::::</pre>

<hr>

<h2>4. Callout Plugin Deep Dive</h2>

<h3>Supported Types</h3>
<p><code>:::note</code>, <code>:::tip</code>, <code>:::warning</code>, <code>:::important</code>, <code>:::caution</code></p>

<h3>Input → Output</h3>
<pre>:::warning
Be careful!
:::</pre>
<p>↓</p>
<pre>&lt;doc-content-callout header="Warning" variant="warning"&gt;
  &lt;p&gt;Be careful!&lt;/p&gt;
&lt;/doc-content-callout&gt;</pre>

<h3>How It Works</h3>
<ol>
  <li><code>visit()</code> traverses all nodes in the tree</li>
  <li>Finds <code>containerDirective</code> nodes named <code>warning</code>, <code>tip</code>, etc.</li>
  <li>Sets <code>hName</code> → output element name</li>
  <li>Sets <code>hProperties</code> → output element attributes</li>
  <li>Children are automatically processed</li>
</ol>
<p><em>(See actual code in demo)</em></p>

<hr>

<h2>5. Video Plugin Overview</h2>

<h3>Input → Output</h3>
<pre>::video{src="https://youtube.com/embed/abc" title="Demo" type="youtube"}</pre>
<p>↓</p>
<pre>&lt;div class="video-plugin-div"&gt;
  &lt;div class="video-plugin-title"&gt;Demo&lt;/div&gt;
  &lt;iframe src="https://youtube.com/embed/abc"&gt;&lt;/iframe&gt;
&lt;/div&gt;</pre>

<h3>Plugin Approaches</h3>
<table>
  <tr><th>Approach</th><th>When to use</th></tr>
  <tr><td><code>hName</code>/<code>hProperties</code></td><td>Simple single element output</td></tr>
  <tr><td>Raw HTML replacement</td><td>Complex nested HTML structure</td></tr>
</table>

<h3>Leaf vs Container</h3>
<table>
  <tr><th>Type</th><th>Has Children</th><th>Approach</th></tr>
  <tr><td>Leaf (<code>::video</code>)</td><td>No</td><td>Either approach works</td></tr>
  <tr><td>Container (<code>:::warning</code>)</td><td>Yes</td><td>Must use hName/hProperties</td></tr>
</table>

<hr>

<h2>6. SFDocs Integration</h2>

<h3>Where Plugins are Registered</h3>
<p><code>packages/@salesforcedocs/doc-framework/src/server/index.ts</code></p>

<h3>Plugin Order Rules</h3>
<table>
  <tr><th>Run Order</th><th>Plugin Type</th><th>Example</th></tr>
  <tr><td>FIRST</td><td>Tree-modifying</td><td><code>::include</code> (inlines content)</td></tr>
  <tr><td>MIDDLE</td><td>Content-transforming</td><td><code>imageTransformer</code> (changes URLs)</td></tr>
  <tr><td>LAST</td><td>Metadata-adding</td><td><code>callout</code>, <code>tabs</code> (sets hName/hProperties)</td></tr>
</table>

<p><strong>Why order matters:</strong></p>
<ul>
  <li><code>remark_directive</code> must run first (parses <code>:::</code> syntax)</li>
  <li>Image transformer before callout (so images inside callouts get transformed)</li>
  <li>Metadata-adding plugins can be flexible among themselves</li>
</ul>

<hr>

<h2>7. Creating a New Plugin</h2>

<h3>Basic Structure</h3>
<ol>
  <li>Create a function that returns a transformer</li>
  <li>Use <code>visit()</code> to traverse the tree</li>
  <li>Find nodes matching your directive</li>
  <li>Set <code>hName</code> and <code>hProperties</code> (or replace with raw HTML)</li>
  <li>Export the plugin function</li>
</ol>

<h3>Register in SFDocs</h3>
<p>Add to <code>doc-framework/src/server/index.ts</code> in the <code>markdownPlugins</code> array.</p>

<hr>

<h2>8. Debugging</h2>

<h3>Using Jest Runner Extension</h3>
<ol>
  <li>Install <strong>Jest Runner</strong> extension in Cursor/VSCode</li>
  <li>Write a simple test case for your plugin</li>
  <li>Click "Run" or "Debug" above the test to debug with breakpoints</li>
</ol>

<h3>Using AST Explorer</h3>
<ol>
  <li>Go to <a href="https://astexplorer.net/">https://astexplorer.net/</a></li>
  <li>Select "Markdown" → "remark" parser</li>
  <li>Paste your markdown to see the AST structure</li>
</ol>

<h3>Debugging After Integration</h3>
<p>If debugging after integrating alpha/latest package with doc-framework:</p>
<ol>
  <li>Start the server in doc-framework:
    <pre>cd doc-framework
yarn start</pre>
  </li>
  <li>Add breakpoints or console.log in <code>node_modules/@salesforcedevs/your-plugin</code></li>
</ol>

<hr>

<h2>9. Publishing Alpha Packages</h2>

<h3>Steps</h3>
<ol>
  <li>Go to the respective plugin package:
    <pre>cd sfdocs-remark-callout-plugin</pre>
  </li>
  <li>Build the package:
    <pre>yarn build</pre>
  </li>
  <li>Publish with alpha tag:
    <pre>yarn publish 1.0.1-example-v1 alpha</pre>
  </li>
</ol>

<h3>Integrating Alpha in doc-framework</h3>
<ol>
  <li>Update dependency in <code>doc-framework/package.json</code>:
    <pre>"@salesforcedevs/sfdocs-remark-callout-plugin": "1.0.1-example-v1"</pre>
  </li>
  <li>Install and test:
    <pre>yarn install
yarn start</pre>
  </li>
</ol>

<h3>Local Development using symlinking (without publishing)</h3>
<ol>
  <li>In your plugin folder:
    <pre>yarn link</pre>
  </li>
  <li>In doc-framework folder:
    <pre>yarn link @salesforcedevs/sfdocs-my-plugin</pre>
  </li>
  <li>Rebuild plugin after changes:
    <pre>yarn build</pre>
  </li>
</ol>

<hr>

<h2>10. References</h2>

<h3>Directive Syntax</h3>
<ul>
  <li><a href="https://talk.commonmark.org/t/generic-directives-plugins-syntax/444">Generic Directives Proposal (CommonMark)</a></li>
</ul>

<h3>Unified Ecosystem</h3>
<ul>
  <li><a href="https://unifiedjs.com/">Unified</a></li>
  <li><a href="https://braincoke.fr/blog/2020/03/an-introduction-to-unified-and-remark/">Introduction to Unified and Remark</a></li>
</ul>

<h3>Remark</h3>
<ul>
  <li><a href="https://remark.js.org/">Remark</a></li>
  <li><a href="https://github.com/remarkjs/remark-directive">remark-directive</a></li>
</ul>

<h3>Syntax Trees</h3>
<ul>
  <li><a href="https://github.com/syntax-tree/mdast">MDAST Specification</a></li>
  <li><a href="https://github.com/syntax-tree/hast">HAST Specification</a></li>
</ul>

<h3>Tools</h3>
<ul>
  <li><a href="https://astexplorer.net/">AST Explorer</a></li>
</ul>

</body>
</html>

